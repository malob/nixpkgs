# Claude Code Configuration

This directory contains my [Claude Code](https://claude.ai/code) configuration files.

## How It Works

These files are symlinked into `~/.claude/` by [Home Manager](https://github.com/nix-community/home-manager) using `mkOutOfStoreSymlink`. This means:

- Files can be edited in place without rebuilding the Nix configuration
- Changes take effect immediately (or on next Claude Code session)
- Everything stays version-controlled in this repo

The symlinks are set up in [`home/claude.nix`](../../home/claude.nix).

## Directory Structure

| Path          | Description                                           |
| ------------- | ----------------------------------------------------- |
| `CLAUDE.md`   | Global instructions loaded in every session           |
| `commands/`   | Custom slash commands                                 |
| `agents/`     | Custom agent definitions                              |
| `skills/`     | Custom skills                                         |
| `rules/`      | Custom rules                                          |
| `hooks/`      | Global hooks (PostToolUse, etc.)                      |
| `plugins/`    | Personal plugin marketplace (see `plugins/README.md`) |

## What's NOT Here

**`settings.json`** and **`mcp.json`** are generated by Nix rather than symlinked. This allows machine-specific paths to be interpolated at build time. To modify settings (permissions, plugins) or MCP servers, edit `home/claude.nix` and rebuild.

## The Home Manager Module

The [`home/claude.nix`](../../home/claude.nix) module:

1. Wraps `claude-code` to include `--mcp-config` pointing to the generated `mcp.json`
2. Generates `settings.json` and `mcp.json` with interpolated paths
3. Generates Claude Desktop config from the same MCP server definitions
4. Symlinks everything else from this directory into `~/.claude/`
5. Wraps MCP servers that have `op://` secrets with `op run` for 1Password expansion
